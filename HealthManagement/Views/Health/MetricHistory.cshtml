@using HealthManagement.Models
@model IEnumerable<ChiSoSucKhoe>

@{
    ViewData["Title"] = "Lịch Sử Chỉ Số Sức Khỏe";
}

<div class="container my-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Trang Chủ</a></li>
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Health")">Sức Khỏe</a></li>
            <li class="breadcrumb-item active">Lịch Sử Chỉ Số</li>
        </ol>
    </nav>

    <h1 class="mb-4"><i class="fas fa-chart-line text-info"></i> Lịch Sử Chỉ Số Sức Khỏe</h1>

    <div class="alert alert-info" role="alert">
        <i class="fas fa-info-circle"></i>
        <strong>Thông Tin:</strong> Danh sách tất cả các chỉ số sức khỏe bạn đã nhập.
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-warning" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Chưa có dữ liệu:</strong> Bạn chưa nhập bất kỳ chỉ số nào. 
            <a href="@Url.Action("AddMetric", "Health")">Nhập chỉ số ngay</a>.
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-hover table-striped">
                <thead class="table-dark">
                    <tr>
                        <th><i class="fas fa-calendar"></i> Ngày Nhập</th>
                        <th><i class="fas fa-tint"></i> Huyết Áp (mmHg)</th>
                        <th><i class="fas fa-heart"></i> Nhịp Tim (bpm)</th>
                        <th><i class="fas fa-droplet"></i> Glucose (mg/dL)</th>
                        <th><i class="fas fa-flask"></i> Cholesterol (mg/dL)</th>
                        <th><i class="fas fa-lungs"></i> SpO2 (%)</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var metric in Model.OrderByDescending(m => m.NgayDo))
                    {
                        <tr>
                            <td>
                                <strong>@metric.NgayDo.ToString("dd/MM/yyyy")</strong>
                                <br />
                                <small class="text-muted">@metric.NgayDo.ToString("HH:mm")</small>
                            </td>
                            <td>
                                <span class="badge bg-info">@metric.HuyetApTam/@metric.HuyetApThan</span>
                            </td>
                            <td>
                                @{
                                    string heartClass = "badge bg-success";
                                    if (metric.NhipTim < 60) heartClass = "badge bg-warning";
                                    else if (metric.NhipTim > 100) heartClass = "badge bg-danger";
                                }
                                <span class="@heartClass">@metric.NhipTim</span>
                            </td>
                            <td>
                                @{
                                    string glucoseClass = "badge bg-success";
                                    if (metric.DuongHuyet < 70) glucoseClass = "badge bg-warning";
                                    else if (metric.DuongHuyet > 125) glucoseClass = "badge bg-danger";
                                }
                                <span class="@glucoseClass">@metric.DuongHuyet</span>
                            </td>
                            <td>
                                @{
                                    string cholClass = "badge bg-danger";
                                    if (metric.Cholesterol < 200) cholClass = "badge bg-success";
                                    else if (metric.Cholesterol < 240) cholClass = "badge bg-warning";
                                }
                                <span class="@cholClass">@metric.Cholesterol</span>
                            </td>
                            <td>
                                @{
                                    string o2Class = metric.ChiSoOxy < 95 ? "badge bg-danger" : "badge bg-success";
                                }
                                <span class="@o2Class">@metric.ChiSoOxy</span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="row mt-4">
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Tổng Số Lần</h6>
                        <h3 class="text-info">@Model.Count()</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Huyết Áp TB</h6>
                        <h5 class="text-primary">@((int)Model.Average(m => m.HuyetApTam))/@((int)Model.Average(m => m.HuyetApThan))</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Nhịp Tim TB</h6>
                        <h5 class="text-warning">@((int)Model.Average(m => m.NhipTim))</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="text-muted">Chol TB</h6>
                        <h5 class="text-secondary">@((int)Model.Average(m => m.Cholesterol))</h5>
                    </div>
                </div>
            </div>
        </div>
    }

    <div class="row mt-4">
        <div class="col-12">
            <div class="d-flex gap-2">
                <a href="@Url.Action("AddMetric", "Health")" class="btn btn-primary">
                    <i class="fas fa-plus-circle"></i> Nhập Chỉ Số Mới
                </a>
                <a href="@Url.Action("Index", "Health")" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left"></i> Quay Lại
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    .badge { font-size: 0.85rem; padding: 0.5rem 0.75rem; }
</style>
